<!-- test.html （ダブルクリックして開く用） -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WS Test Local</title>
</head>
<body>
  <pre id="log">INIT</pre>

  <script>
    const HOST = "localhost";   // ローカルのみ
    const PORT = 8765;
    const URL  = `ws://${HOST}:${PORT}`;

    const logEl = document.getElementById("log");
    function log(msg) {
      console.log(msg);
      logEl.textContent += "\n" + msg;
    }

    log("CONNECTING " + URL + " ...");

    let ws;
    try {
      ws = new WebSocket(URL);
    } catch (e) {
      log("NEW WEBSOCKET ERROR: " + e);
    }

    if (ws) {
      ws.onopen = () => {
        log("OPEN");
        ws.send("hello from browser");
      };
      ws.onmessage = (ev) => {
        log("MESSAGE: " + ev.data);
      };
      ws.onerror = (ev) => {
        log("ERROR: " + JSON.stringify(ev));
      };
      ws.onclose = () => {
        log("CLOSE");
      };
    }
  </script>
</body>
</html>
